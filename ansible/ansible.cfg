# Ansible Configuration for OpenStack Multi-Tenant Environment
[defaults]
# SECURITY FIX: Enable host key checking for production
host_key_checking = True
retry_files_enabled = False
stdout_callback = yaml
stderr_callback = yaml
timeout = 60
gather_timeout = 60
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts_cache
fact_caching_timeout = 86400
ansible_managed = Ansible managed: {file} modified on %Y-%m-%d %H:%M:%S by {uid} on {host}

# Inventory settings
inventory = inventory/production
remote_user = ubuntu
private_key_file = ~/.ssh/openstack_key.pem

# Security settings
# SECURITY FIX: Limit concurrent connections and enable serial execution
forks = 5
serial = 1

# SSH settings - SECURITY ENHANCED
# SECURITY FIX: Remove StrictHostKeyChecking=no and enable proper host verification
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o ServerAliveInterval=30 -o ServerAliveCountMax=3 -o ConnectTimeout=10
pipelining = True
control_path_dir = /tmp/ansible-ssh-%%h-%%p-%%r
control_path = %(control_path_dir)s/ansible-ssh-%%h-%%p-%%r

# Privilege escalation
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# Logging - SECURITY ENHANCED
log_path = ./ansible.log
action_warnings = True
deprecation_warnings = True
system_warnings = True

# Role settings
roles_path = roles:../ansible-galaxy-roles

# Collections settings
collections_path = collections

# Vault settings
vault_password_file = .vault_pass

# SECURITY FIX: Add security-focused settings
[defaults]
# Disable retry files that might contain sensitive data
retry_files_enabled = False
# Prevent logging of sensitive data
no_log = False
# Enable task profiling for security monitoring
callback_plugins = profile_tasks

[inventory]
enable_plugins = openstack, auto, host_list, script, yaml, ini, toml

[ssh_connection]
# SECURITY FIX: Enhanced SSH security settings
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o ServerAliveInterval=30 -o ServerAliveCountMax=3 -o ConnectTimeout=10 -o LogLevel=ERROR
pipelining = True
control_path = /tmp/ansible-ssh-%%h-%%p-%%r
# SECURITY FIX: Enable SSH connection timeout
connect_timeout = 30

[persistent_connection]
connect_timeout = 60
command_timeout = 60
